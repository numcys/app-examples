services:
  web:
    domain: ${HOST}
    image: drupal:10-apache
    port: 80
    ports:
      - 8080
    lifecycle:
      postStart: "/bin/bash", "-c", "cp -r /var/www/html/sites//data/; chown www-data:www-data/data/-R"
    resources:
      - db1
    volumeOptions:
      - awsEfs:
          id: "drupal"
          accessMode: ReadWriteMany
          mountPath: "/var/www/html/modules"
      - awsEfs:
          id: "drupal"
          accessMode: ReadWriteMany
          mountPath: "/var/www/html/profiles"
      - awsEfs:
          id: "drupal"
          accessMode: ReadWriteMany
          mountPath: "/var/www/html/themes"
      - awsEfs:
          id: "drupal"
          accessMode: ReadWriteMany
          mountPath: "/var/www/html/sites"

balancers:
  custom:
    service: web
    ports:
      3000: 8080
      5000: 80
resources:
  db1:
    type: postgres
    options:
      storage: 10
      class: db.t3.large
      version: 16


